import unittest
from phononExpansion import *
import pytest

class TestModule(unittest.TestCase):
    def testConvol(self):
        t1 = [0.2, 0.6, 0.8, 2.0, 6.0, 8.0]
        t2 = [0.2, 0.6, 0.8, 2.0, 6.0, 8.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, \
              0.0, 0.0, 0.0, 0.0, 0.0]
        delta = 0.03
        nn = 18
        t3 = convol(t1,t2,delta,nn)
        correct_t3 = [3.8459762, 2.6993367, 1.0195307, 0.53364442, 0.37281623, \
                      0.384, 0.624, 1.008, 1.8, 2.16, 0.96, 0, 0, 0, 0, 0, 0, 0]
        for i in range(len(t3)):
            assert t3[i] == pytest.approx(correct_t3[i])

        t1 = [0.01, 0.04, 0.09, 0.11, 0.16, 0.21]
        t2 = [0.01, 0.04, 0.09, 0.11, 0.16, 0.21, 0.00, 0.00, 0.00, 0.00, 0.00,\
              0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00 ]
        delta = 0.5
        nn = 18
        correct_t3 = [1.1974704E-2, 1.3563056E-2, 1.3531928E-2, 1.379648E-2, \
          1.387114E-2, 1.7875E-2, 2.675E-2, 3.1775E-2, 3.0125E-2, 2.52E-2, \
          1.1025E-2, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]

        t3 = convol(t1,t2,delta,nn)
        for i in range(len(t3)):
            assert t3[i] == pytest.approx(correct_t3[i])


    def testGettingLambda_s(self):
        delta = 0.00255/2.5507297688e-2
        rho = [0,0.0005,0.001,0.002,0.0035,0.005,0.0075,0.01,0.013,0.0165,0.02,0.0245,0.029,0.034,0.0395,0.045,0.0506,0.0562,0.0622,0.0686,0.075,0.083,0.091,0.099,0.107,0.115,0.1197,0.1214,0.1218,0.1195,0.1125,0.1065,0.1005,0.09542,0.09126,0.0871,0.0839,0.0807,0.07798,0.07574,0.0735,0.07162,0.06974,0.06804,0.06652,0.065,0.0634,0.0618,0.06022,0.05866,0.0571,0.05586,0.05462,0.0535,0.0525,0.0515,0.05042,0.04934,0.04822,0.04706,0.0459,0.04478,0.04366,0.04288,0.04244,0.042,0]
        alpha = [0.01, 0.08, 4.0, 6.0, 20.0, 50.0]
        beta  = [0.0, 0.4, 1.0, 5.0, 9.0, 20.0]
        #lambda_s = getLambda_s(delta, rho)
        lambda_s = contin(100, delta, rho, alpha, beta)
        assert lambda_s == pytest.approx(0.529209971221177)






if __name__ == '__main__':
    unittest.main()
